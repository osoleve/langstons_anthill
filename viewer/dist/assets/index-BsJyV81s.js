var T=Object.defineProperty;var O=(t,e,n)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>O(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();class j{constructor(e="/events"){v(this,"eventSource",null);v(this,"handlers",new Set);v(this,"lastState",null);this.url=e}connect(){this.eventSource=new EventSource(this.url),this.eventSource.onmessage=e=>{try{const n=JSON.parse(e.data);this.lastState=n,this.handlers.forEach(o=>o(n))}catch(n){console.error("Failed to parse state:",n)}},this.eventSource.onerror=()=>{console.error("SSE connection error, reconnecting..."),this.reconnect()}}reconnect(){this.disconnect(),setTimeout(()=>this.connect(),2e3)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}onState(e){return this.handlers.add(e),this.lastState&&e(this.lastState),()=>this.handlers.delete(e)}getLastState(){return this.lastState}}async function B(){try{return await(await fetch("/state")).json()}catch{return null}}function H(t){const e=document.createElement("canvas");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.pointerEvents="none",t.appendChild(e);const n=e.getContext("2d");function o(){e.width=t.clientWidth,e.height=t.clientHeight}return o(),window.addEventListener("resize",o),{canvas:e,ctx:n,get width(){return e.width},get height(){return e.height}}}function P(t){t.ctx.clearRect(0,0,t.width,t.height)}const b=100,$=20,_=250,x=150;function C(t){const e=t.x*(b+$)+_,n=t.y*(b+$)+x;return{x:e,y:n,centerX:e+b/2,centerY:n+b/2}}function c(t,e){const n=e[t];if(!n)return null;const o=C(n);return{x:o.centerX,y:o.centerY}}function k(t,e){var a,f;const n=t.querySelector(".tiles-container");n&&n.remove();const o=document.createElement("div");o.className="tiles-container",t.appendChild(o);const i=((a=e.map)==null?void 0:a.tiles)??{},r=e.systems??{},s=e.entities??[];for(const[u,m]of Object.entries(i)){const l=document.createElement("div");l.className="tile";const M=r[u];M&&(l.classList.add("has-system"),M.generates&&Object.keys(M.generates).length>0&&l.classList.add("generating")),m.blighted&&l.classList.add("blighted"),m.type==="antenna"&&(l.classList.add("antenna"),(((f=e.resources)==null?void 0:f.influence)??0)>.5&&l.classList.add("broadcasting"));const L=C(m);l.style.left=`${L.x}px`,l.style.top=`${L.y}px`;const S=s.filter(y=>y.tile===u&&y.type!=="visitor").length,w=s.filter(y=>y.tile===u&&y.type==="visitor").length;let E="";S>0&&(E+=`<div class="ant-count">${S} ant${S>1?"s":""}</div>`),w>0&&(E+=`<div class="ant-count visitor-count">${w} visitor${w>1?"s":""}</div>`),l.innerHTML=`
      <div class="tile-name">${m.name}</div>
      <div class="tile-info">${m.type}</div>
      ${E}
    `,o.appendChild(l)}}function F(t,e){var i,r;const n=(i=e.map)==null?void 0:i.tiles,o=(r=e.map)==null?void 0:r.connections;if(!(!n||!o)){t.strokeStyle="#333",t.lineWidth=1,t.setLineDash([4,4]);for(const[s,a]of o){const f=c(s,n),u=c(a,n);f&&u&&(t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(u.x,u.y),t.stroke())}t.setLineDash([])}}const h=new Map;function X(t){var i;const e=(i=t.map)==null?void 0:i.tiles,n=t.entities;if(!e||!n)return;for(const r of n){const s=c(r.tile,e);if(!s)continue;let a=h.get(r.id);a||(a={x:s.x+(Math.random()-.5)*60,y:s.y+(Math.random()-.5)*60,targetX:s.x+(Math.random()-.5)*60,targetY:s.y+(Math.random()-.5)*60,type:r.type,subtype:r.subtype,adorned:r.adorned},h.set(r.id,a)),a.x+=(a.targetX-a.x)*.02,a.y+=(a.targetY-a.y)*.02,Math.random()<.01&&(a.targetX=s.x+(Math.random()-.5)*60,a.targetY=s.y+(Math.random()-.5)*60),a.type=r.type,a.subtype=r.subtype,a.adorned=r.adorned}const o=new Set(n.map(r=>r.id));for(const r of h.keys())o.has(r)||h.delete(r)}function Y(t){for(const[e,n]of h){t.beginPath();const o=n.adorned?5:4;if(n.type==="visitor"){const i=n.subtype==="hungry"?"#f88":"#8af";t.arc(n.x,n.y,o,0,Math.PI*2),t.fillStyle=i,t.shadowColor=i,t.shadowBlur=8}else n.adorned?(t.arc(n.x,n.y,o,0,Math.PI*2),t.fillStyle="#ca8",t.shadowColor="#ca8",t.shadowBlur=6):(t.arc(n.x,n.y,o-1,0,Math.PI*2),t.fillStyle="#a85",t.shadowBlur=0);t.fill(),t.shadowBlur=0}}const g=[];function d(t,e,n){g.push({x:t.x,y:t.y,targetX:e.x,targetY:e.y,progress:0,speed:.01+Math.random()*.01,color:n,size:2+Math.random()*2})}function D(){for(let t=g.length-1;t>=0;t--){const e=g[t];e.progress+=e.speed,e.x+=(e.targetX-e.x)*e.speed*2,e.y+=(e.targetY-e.y)*e.speed*2,e.progress>=1&&g.splice(t,1)}}function A(t){var o,i,r;const e=(o=t.map)==null?void 0:o.tiles;if(!e)return;if(Math.random()<.1){const s=c("dig_site",e),a=c("origin",e);s&&a&&d(s,a,"#8b7355")}if(Math.random()<.05){const s=c("compost",e),a=c("origin",e);s&&a&&d(s,a,"#5a8a5a")}if(Math.random()<.05){const s=c("origin",e),a=c("fungus_farm",e);s&&a&&d(s,a,"#5a8a5a")}if(Math.random()<.03){const s=c("fungus_farm",e),a=c("origin",e);s&&a&&d(s,a,"#7a6a9a")}if(Math.random()<.02){const s=c("crystal_cave",e),a=c("resonance_chamber",e);s&&a&&d(s,a,"#aaccff")}if(Math.random()<.08){const s=c("resonance_chamber",e),a=c("origin",e);s&&a&&d(s,a,"#88aacc")}if((((i=t.resources)==null?void 0:i.influence)??0)>0&&Math.random()<.05){const s=c("origin",e),a=c("receiver",e);s&&a&&d(s,a,"#aa88ff")}if(((r=t.entities)==null?void 0:r.some(s=>s.subtype==="observer"))&&Math.random()<.1){const s=c("receiver",e);s&&d({x:s.x+(Math.random()-.5)*30,y:s.y+(Math.random()-.5)*30},{x:s.x,y:s.y-40},"#88ffaa")}}function N(t){for(const e of g)t.beginPath(),t.arc(e.x,e.y,e.size*(1-e.progress*.5),0,Math.PI*2),t.fillStyle=e.color,t.globalAlpha=1-e.progress,t.fill();t.globalAlpha=1}function z(t){const e=document.getElementById("tick");e&&(e.textContent=`tick: ${t.tick}`)}function R(t){const e=document.getElementById("resources");if(!e)return;const n=t.resources??{};if(Object.keys(n).length===0){e.innerHTML='<div class="empty">nothing yet</div>';return}e.innerHTML=Object.entries(n).map(([o,i])=>`
      <div class="resource">
        <span class="resource-name">${o}</span>
        <span class="resource-value">${Math.floor(i??0)}</span>
      </div>
    `).join("")}function q(t){const e=document.getElementById("entities");if(!e)return;const n=t.entities??[];if(n.length===0){e.innerHTML='<div class="empty">no entities</div>';return}const o={},i=[];for(const s of n)if(s.type==="visitor")i.push(s);else{const a=s.role??s.type??"unknown";o[a]=(o[a]??0)+1}let r=Object.entries(o).map(([s,a])=>`
      <div class="stat-row">
        <span class="stat-label">${s}</span>
        <span class="stat-value">${a}</span>
      </div>
    `).join("");for(const s of i)r+=`
      <div class="stat-row visitor-row">
        <span class="stat-label">${s.name??s.subtype??"visitor"}</span>
        <span class="stat-value visitor-subtype">${s.subtype??""}</span>
      </div>
    `;e.innerHTML=r}function G(t){var i;const e=document.getElementById("boredom-fill");if(!e)return;const n=((i=t.meta)==null?void 0:i.boredom)??0,o=Math.min(100,n/60*100);e.style.width=`${o}%`}function W(t){var i;const e=document.getElementById("sanity-fill"),n=document.getElementById("sanity-value");if(!e||!n)return;const o=((i=t.meta)==null?void 0:i.sanity)??100;e.style.width=`${o}%`,n.textContent=`${o.toFixed(1)}%`,o<30?e.style.background="#a44":o<60?e.style.background="#a84":e.style.background="#484"}function J(t){var r,s;const e=document.getElementById("contamination-fill"),n=document.getElementById("contamination-status");if(!e||!n)return;const o=(s=(r=t.map)==null?void 0:r.tiles)==null?void 0:s.compost,i=(o==null?void 0:o.contamination)??0;e.style.width=`${i*100}%`,o!=null&&o.blighted?(n.textContent=`BLIGHTED (${o.blight_ticks_remaining}t remaining)`,n.style.color="#a55"):i>0?(n.textContent=`${(i*100).toFixed(1)}% blight chance`,n.style.color="#755"):(n.textContent="clean",n.style.color="#555")}function K(t){const e=document.getElementById("systems");if(!e)return;const n=t.systems??{};if(Object.keys(n).length===0){e.innerHTML='<div class="empty">no systems</div>';return}e.innerHTML=Object.entries(n).map(([o,i])=>{let r="";return i.generates&&Object.keys(i.generates).length>0&&(r=Object.entries(i.generates).map(([s,a])=>`+${a}/tick ${s}`).join(", ")),`
        <div class="system">
          <div class="system-name">${i.name??o}</div>
          <div class="system-output">${r||"idle"}</div>
        </div>
      `}).join("")}function Z(t){const e=document.getElementById("corpses");if(!e)return;const n=t.graveyard??{corpses:[],total_processed:0},o=n.corpses??[],i=n.total_processed??0;if(o.length===0&&i===0){e.innerHTML='<div class="empty">none</div>';return}e.innerHTML=`
    <div class="stat-row">
      <span class="stat-label">awaiting</span>
      <span class="stat-value">${o.length}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">processed</span>
      <span class="stat-value">${i}</span>
    </div>
  `}function Q(t){var o;const e=document.getElementById("rejected");if(!e)return;const n=((o=t.meta)==null?void 0:o.rejected_ideas)??[];if(n.length===0){e.innerHTML='<div class="empty">empty</div>';return}e.innerHTML=n.map(i=>`<div class="graveyard-item">${i}</div>`).join("")}function U(t){var i;const e=document.getElementById("event-log");if(!e)return;const n=((i=t.meta)==null?void 0:i.event_log)??[];if(n.length===0){e.innerHTML='<div class="empty">no events yet</div>';return}const o=n.slice(-10).reverse();e.innerHTML=o.map(r=>`
      <div class="event-entry event-type-${r.type}">
        <div class="event-tick">t${r.tick}</div>
        <div class="event-message">${r.message}</div>
      </div>
    `).join("")}function V(t){z(t),R(t),q(t),G(t),W(t),J(t),K(t),Z(t),Q(t),U(t)}let p=null;function I(){const t=document.getElementById("map");if(!t){console.error("Map container not found");return}const e=t,n=H(e),o=new j("/events");function i(s){p=s,V(s),k(e,s)}function r(){p&&(P(n),F(n.ctx,p),X(p),Y(n.ctx),A(p),D(),N(n.ctx)),requestAnimationFrame(r)}o.onState(i),o.connect(),r(),B().then(s=>{s&&i(s)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();
//# sourceMappingURL=index-BsJyV81s.js.map

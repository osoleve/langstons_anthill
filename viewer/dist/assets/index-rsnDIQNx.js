var P=Object.defineProperty;var j=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var L=(e,t,n)=>j(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();class O{constructor(t="/events"){L(this,"eventSource",null);L(this,"handlers",new Set);L(this,"lastState",null);this.url=t}connect(){this.eventSource=new EventSource(this.url),this.eventSource.onmessage=t=>{try{const n=JSON.parse(t.data);this.lastState=n,this.handlers.forEach(i=>i(n))}catch(n){console.error("Failed to parse state:",n)}},this.eventSource.onerror=()=>{console.error("SSE connection error, reconnecting..."),this.reconnect()}}reconnect(){this.disconnect(),setTimeout(()=>this.connect(),2e3)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}onState(t){return this.handlers.add(t),this.lastState&&t(this.lastState),()=>this.handlers.delete(t)}getLastState(){return this.lastState}}async function B(){try{return await(await fetch("/state")).json()}catch{return null}}function H(e){const t=document.createElement("canvas");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.pointerEvents="none",e.appendChild(t);const n=t.getContext("2d");function i(){t.width=e.clientWidth,t.height=e.clientHeight}return i(),window.addEventListener("resize",i),{canvas:t,ctx:n,get width(){return t.width},get height(){return t.height}}}function x(e){e.ctx.clearRect(0,0,e.width,e.height)}const C=100,I=20,k=250,Y=150;function _(e){const t=e.x*(C+I)+k,n=e.y*(C+I)+Y;return{x:t,y:n,centerX:t+C/2,centerY:n+C/2}}function l(e,t){const n=t[e];if(!n)return null;const i=_(n);return{x:i.centerX,y:i.centerY}}function F(e,t){var o,u;const n=e.querySelector(".tiles-container");n&&n.remove();const i=document.createElement("div");i.className="tiles-container",e.appendChild(i);const a=((o=t.map)==null?void 0:o.tiles)??{},r=t.systems??{},s=t.entities??[];for(const[d,m]of Object.entries(a)){const c=document.createElement("div");c.className="tile";const p=r[d];p&&(c.classList.add("has-system"),p.generates&&Object.keys(p.generates).length>0&&c.classList.add("generating")),m.blighted&&c.classList.add("blighted"),m.type==="antenna"&&(c.classList.add("antenna"),(((u=t.resources)==null?void 0:u.influence)??0)>.5&&c.classList.add("broadcasting"));const M=_(m);c.style.left=`${M.x}px`,c.style.top=`${M.y}px`;const y=s.filter(g=>g.tile===d&&g.type!=="visitor").length,h=s.filter(g=>g.tile===d&&g.type==="visitor").length;let w="";y>0&&(w+=`<div class="ant-count">${y} ant${y>1?"s":""}</div>`),h>0&&(w+=`<div class="ant-count visitor-count">${h} visitor${h>1?"s":""}</div>`),c.innerHTML=`
      <div class="tile-name">${m.name}</div>
      <div class="tile-info">${m.type}</div>
      ${w}
    `,i.appendChild(c)}}function X(e,t){var a,r;const n=(a=t.map)==null?void 0:a.tiles,i=(r=t.map)==null?void 0:r.connections;if(!(!n||!i)){e.strokeStyle="#333",e.lineWidth=1,e.setLineDash([4,4]);for(const[s,o]of i){const u=l(s,n),d=l(o,n);u&&d&&(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(d.x,d.y),e.stroke())}e.setLineDash([])}}const $=new Map;function D(){return $}function A(e){var a;const t=(a=e.map)==null?void 0:a.tiles,n=e.entities;if(!t||!n)return;for(const r of n){const s=l(r.tile,t);if(!s)continue;let o=$.get(r.id);o||(o={x:s.x+(Math.random()-.5)*60,y:s.y+(Math.random()-.5)*60,targetX:s.x+(Math.random()-.5)*60,targetY:s.y+(Math.random()-.5)*60,type:r.type,subtype:r.subtype,adorned:r.adorned,entity:r},$.set(r.id,o)),o.x+=(o.targetX-o.x)*.02,o.y+=(o.targetY-o.y)*.02,Math.random()<.01&&(o.targetX=s.x+(Math.random()-.5)*60,o.targetY=s.y+(Math.random()-.5)*60),o.type=r.type,o.subtype=r.subtype,o.adorned=r.adorned,o.entity=r}const i=new Set(n.map(r=>r.id));for(const r of $.keys())i.has(r)||$.delete(r)}function N(e){for(const[t,n]of $){e.beginPath();const i=n.adorned?5:4;if(n.type==="visitor"){const a=n.subtype==="hungry"?"#f88":"#8af";e.arc(n.x,n.y,i,0,Math.PI*2),e.fillStyle=a,e.shadowColor=a,e.shadowBlur=8}else n.adorned?(e.arc(n.x,n.y,i,0,Math.PI*2),e.fillStyle="#ca8",e.shadowColor="#ca8",e.shadowBlur=6):(e.arc(n.x,n.y,i-1,0,Math.PI*2),e.fillStyle="#a85",e.shadowBlur=0);e.fill(),e.shadowBlur=0}}const E=[];function v(e,t,n){E.push({x:e.x,y:e.y,targetX:t.x,targetY:t.y,progress:0,speed:.01+Math.random()*.01,color:n,size:2+Math.random()*2})}function R(){for(let e=E.length-1;e>=0;e--){const t=E[e];t.progress+=t.speed,t.x+=(t.targetX-t.x)*t.speed*2,t.y+=(t.targetY-t.y)*t.speed*2,t.progress>=1&&E.splice(e,1)}}function z(e){var i,a,r;const t=(i=e.map)==null?void 0:i.tiles;if(!t)return;if(Math.random()<.1){const s=l("dig_site",t),o=l("origin",t);s&&o&&v(s,o,"#8b7355")}if(Math.random()<.05){const s=l("compost",t),o=l("origin",t);s&&o&&v(s,o,"#5a8a5a")}if(Math.random()<.05){const s=l("origin",t),o=l("fungus_farm",t);s&&o&&v(s,o,"#5a8a5a")}if(Math.random()<.03){const s=l("fungus_farm",t),o=l("origin",t);s&&o&&v(s,o,"#7a6a9a")}if(Math.random()<.02){const s=l("crystal_cave",t),o=l("resonance_chamber",t);s&&o&&v(s,o,"#aaccff")}if(Math.random()<.08){const s=l("resonance_chamber",t),o=l("origin",t);s&&o&&v(s,o,"#88aacc")}if((((a=e.resources)==null?void 0:a.influence)??0)>0&&Math.random()<.05){const s=l("origin",t),o=l("receiver",t);s&&o&&v(s,o,"#aa88ff")}if(((r=e.entities)==null?void 0:r.some(s=>s.subtype==="observer"))&&Math.random()<.1){const s=l("receiver",t);s&&v({x:s.x+(Math.random()-.5)*30,y:s.y+(Math.random()-.5)*30},{x:s.x,y:s.y-40},"#88ffaa")}}function G(e){for(const t of E)e.beginPath(),e.arc(t.x,t.y,t.size*(1-t.progress*.5),0,Math.PI*2),e.fillStyle=t.color,e.globalAlpha=1-t.progress,e.fill();e.globalAlpha=1}const b=new Map;function V(e){var a,r;const t=(a=e.map)==null?void 0:a.tiles,n=((r=e.graveyard)==null?void 0:r.corpses)??[];if(!t)return;const i=new Set(n.map(s=>s.entity_id));for(const s of n)if(!b.has(s.entity_id)){const o=l(s.tile,t);o&&b.set(s.entity_id,{id:s.entity_id,x:o.x+(Math.random()-.5)*40,y:o.y+(Math.random()-.5)*40,baseY:o.y+(Math.random()-.5)*40,alpha:.6,phase:Math.random()*Math.PI*2,isVisitor:s.entity_type==="visitor"})}for(const[s,o]of b)o.phase+=.02,o.y=o.baseY+Math.sin(o.phase)*5-o.phase*.3,o.alpha-=5e-4,(o.alpha<=0||o.y<o.baseY-50)&&b.delete(s);for(const s of b.keys())if(!i.has(s)){const o=b.get(s);o&&(o.alpha-=.02,o.alpha<=0&&b.delete(s))}}function q(e){for(const[t,n]of b){e.save(),e.globalAlpha=n.alpha;const i=e.createRadialGradient(n.x,n.y,0,n.x,n.y,12);n.isVisitor?(i.addColorStop(0,"rgba(150, 180, 255, 0.8)"),i.addColorStop(.5,"rgba(100, 130, 200, 0.4)"),i.addColorStop(1,"rgba(80, 100, 180, 0)")):(i.addColorStop(0,"rgba(220, 200, 180, 0.8)"),i.addColorStop(.5,"rgba(180, 160, 140, 0.4)"),i.addColorStop(1,"rgba(150, 130, 110, 0)")),e.fillStyle=i,e.beginPath(),e.arc(n.x,n.y,12,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n.x-2,n.y-2,3,0,Math.PI*2),e.fillStyle=n.isVisitor?"rgba(200, 220, 255, 0.5)":"rgba(255, 250, 240, 0.5)",e.fill(),e.restore()}}function W(e){const t=document.getElementById("tick");t&&(t.textContent=`tick: ${e.tick}`)}function J(e){const t=document.getElementById("resources");if(!t)return;const n=e.resources??{};if(Object.keys(n).length===0){t.innerHTML='<div class="empty">nothing yet</div>';return}t.innerHTML=Object.entries(n).map(([i,a])=>`
      <div class="resource">
        <span class="resource-name">${i}</span>
        <span class="resource-value">${Math.floor(a??0)}</span>
      </div>
    `).join("")}function K(e){const t=document.getElementById("entities");if(!t)return;const n=e.entities??[];if(n.length===0){t.innerHTML='<div class="empty">no entities</div>';return}const i={},a=[];for(const s of n)if(s.type==="visitor")a.push(s);else{const o=s.role??s.type??"unknown";i[o]=(i[o]??0)+1}let r=Object.entries(i).map(([s,o])=>`
      <div class="stat-row">
        <span class="stat-label">${s}</span>
        <span class="stat-value">${o}</span>
      </div>
    `).join("");for(const s of a)r+=`
      <div class="stat-row visitor-row">
        <span class="stat-label">${s.name??s.subtype??"visitor"}</span>
        <span class="stat-value visitor-subtype">${s.subtype??""}</span>
      </div>
    `;t.innerHTML=r}function Z(e){var a;const t=document.getElementById("boredom-fill");if(!t)return;const n=((a=e.meta)==null?void 0:a.boredom)??0,i=Math.min(100,n/60*100);t.style.width=`${i}%`}function Q(e){var a;const t=document.getElementById("sanity-fill"),n=document.getElementById("sanity-value");if(!t||!n)return;const i=((a=e.meta)==null?void 0:a.sanity)??100;t.style.width=`${i}%`,n.textContent=`${i.toFixed(1)}%`,i<30?t.style.background="#a44":i<60?t.style.background="#a84":t.style.background="#484"}function U(e){var r,s;const t=document.getElementById("contamination-fill"),n=document.getElementById("contamination-status");if(!t||!n)return;const i=(s=(r=e.map)==null?void 0:r.tiles)==null?void 0:s.compost,a=(i==null?void 0:i.contamination)??0;t.style.width=`${a*100}%`,i!=null&&i.blighted?(n.textContent=`BLIGHTED (${i.blight_ticks_remaining}t remaining)`,n.style.color="#a55"):a>0?(n.textContent=`${(a*100).toFixed(1)}% blight chance`,n.style.color="#755"):(n.textContent="clean",n.style.color="#555")}function ee(e){const t=document.getElementById("systems");if(!t)return;const n=e.systems??{};if(Object.keys(n).length===0){t.innerHTML='<div class="empty">no systems</div>';return}t.innerHTML=Object.entries(n).map(([i,a])=>{let r="";return a.generates&&Object.keys(a.generates).length>0&&(r=Object.entries(a.generates).map(([s,o])=>`+${o}/tick ${s}`).join(", ")),`
        <div class="system">
          <div class="system-name">${a.name??i}</div>
          <div class="system-output">${r||"idle"}</div>
        </div>
      `}).join("")}function te(e){const t=document.getElementById("corpses");if(!t)return;const n=e.graveyard??{corpses:[],total_processed:0},i=n.corpses??[],a=n.total_processed??0;if(i.length===0&&a===0){t.innerHTML='<div class="empty">none</div>';return}t.innerHTML=`
    <div class="stat-row">
      <span class="stat-label">awaiting</span>
      <span class="stat-value">${i.length}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">processed</span>
      <span class="stat-value">${a}</span>
    </div>
  `}function ne(e){var i;const t=document.getElementById("rejected");if(!t)return;const n=((i=e.meta)==null?void 0:i.rejected_ideas)??[];if(n.length===0){t.innerHTML='<div class="empty">empty</div>';return}t.innerHTML=n.map(a=>`<div class="graveyard-item">${a}</div>`).join("")}function se(e){var a;const t=document.getElementById("event-log");if(!t)return;const n=((a=e.meta)==null?void 0:a.event_log)??[];if(n.length===0){t.innerHTML='<div class="empty">no events yet</div>';return}const i=n.slice(-10).reverse();t.innerHTML=i.map(r=>`
      <div class="event-entry event-type-${r.type}">
        <div class="event-tick">t${r.tick}</div>
        <div class="event-message">${r.message}</div>
      </div>
    `).join("")}function oe(e){var r;const t=document.getElementById("goals");if(!t)return;const n=((r=e.meta)==null?void 0:r.goals)??{},i=e.resources??{},a=Object.entries(n).filter(([s,o])=>!o.built&&o.progress!==void 0);if(a.length===0){t.innerHTML='<div class="empty">no active goals</div>';return}t.innerHTML=a.map(([s,o])=>{const u=Object.entries(o.cost),d=u.map(([c,p])=>{var g;const M=i[c]??0,y=((g=o.progress)==null?void 0:g[c])??0,h=Math.min(100,y/p*100),w=M>0&&y<p;return`
          <div class="goal-resource">
            <div class="goal-resource-header">
              <span class="goal-resource-name">${c}</span>
              <span class="goal-resource-count">${Math.floor(y)}/${p}</span>
            </div>
            <div class="goal-bar">
              <div class="goal-bar-fill ${w?"can-contribute":""}" style="width: ${h}%"></div>
            </div>
          </div>
        `}).join(""),m=u.reduce((c,[p,M])=>{var h;const y=((h=o.progress)==null?void 0:h[p])??0;return c+y/M},0)/u.length*100;return`
        <div class="goal-card">
          <div class="goal-header">
            <span class="goal-name">${o.name}</span>
            <span class="goal-pct">${m.toFixed(0)}%</span>
          </div>
          <div class="goal-desc">${o.description}</div>
          <div class="goal-resources">
            ${d}
          </div>
        </div>
      `}).join("")}function ie(e){W(e),J(e),K(e),Z(e),Q(e),U(e),ee(e),te(e),ne(e),se(e),oe(e)}let f=null;function re(){f=document.createElement("div"),f.className="entity-tooltip",f.style.display="none",document.body.appendChild(f)}function ae(e,t,n){if(!f)return;const i=t.getBoundingClientRect(),a=e.clientX-i.left,r=e.clientY-i.top;let s=null,o=20;for(const[u,d]of n){const m=d.x-a,c=d.y-r,p=Math.sqrt(m*m+c*c);p<o&&(o=p,s=d.entity)}s?ce(s,e.clientX,e.clientY):le()}function ce(e,t,n){if(!f)return;const i=(e.age/e.max_age*100).toFixed(1),a=e.hunger.toFixed(1);let r='<div class="tooltip-header">';e.type==="visitor"?r+=`<span class="tooltip-type visitor">${e.name||e.subtype||"visitor"}</span>`:(r+=`<span class="tooltip-type">${e.role||"ant"}</span>`,e.adorned&&(r+='<span class="tooltip-adorned">â˜…</span>')),r+="</div>",r+='<div class="tooltip-stats">',r+=`<div class="tooltip-row"><span>age:</span><span>${i}%</span></div>`,r+=`<div class="tooltip-row"><span>hunger:</span><span>${a}</span></div>`,r+=`<div class="tooltip-row"><span>tile:</span><span>${e.tile}</span></div>`,e.type==="visitor"&&e.description&&(r+=`<div class="tooltip-desc">${e.description}</div>`),e.processing_corpse&&(r+='<div class="tooltip-activity">processing corpse...</div>'),r+="</div>",f.innerHTML=r,f.style.display="block",f.style.left=`${t+15}px`,f.style.top=`${n+15}px`}function le(){f&&(f.style.display="none")}let S=null;function T(){const e=document.getElementById("map");if(!e){console.error("Map container not found");return}const t=e,n=H(t),i=new O("/events");re(),t.addEventListener("mousemove",s=>{const o=D();ae(s,t,o)});function a(s){S=s,ie(s),F(t,s)}function r(){S&&(x(n),X(n.ctx,S),V(S),q(n.ctx),A(S),N(n.ctx),z(S),R(),G(n.ctx)),requestAnimationFrame(r)}i.onState(a),i.connect(),r(),B().then(s=>{s&&a(s)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T):T();
//# sourceMappingURL=index-rsnDIQNx.js.map

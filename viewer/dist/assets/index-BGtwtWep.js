var O=Object.defineProperty;var T=(t,e,n)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>T(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();class j{constructor(e="/events"){v(this,"eventSource",null);v(this,"handlers",new Set);v(this,"lastState",null);this.url=e}connect(){this.eventSource=new EventSource(this.url),this.eventSource.onmessage=e=>{try{const n=JSON.parse(e.data);this.lastState=n,this.handlers.forEach(o=>o(n))}catch(n){console.error("Failed to parse state:",n)}},this.eventSource.onerror=()=>{console.error("SSE connection error, reconnecting..."),this.reconnect()}}reconnect(){this.disconnect(),setTimeout(()=>this.connect(),2e3)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}onState(e){return this.handlers.add(e),this.lastState&&e(this.lastState),()=>this.handlers.delete(e)}getLastState(){return this.lastState}}async function B(){try{return await(await fetch("/state")).json()}catch{return null}}function P(t){const e=document.createElement("canvas");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.pointerEvents="none",t.appendChild(e);const n=e.getContext("2d");function o(){e.width=t.clientWidth,e.height=t.clientHeight}return o(),window.addEventListener("resize",o),{canvas:e,ctx:n,get width(){return e.width},get height(){return e.height}}}function _(t){t.ctx.clearRect(0,0,t.width,t.height)}const b=100,$=20,x=250,H=150;function I(t){const e=t.x*(b+$)+x,n=t.y*(b+$)+H;return{x:e,y:n,centerX:e+b/2,centerY:n+b/2}}function c(t,e){const n=e[t];if(!n)return null;const o=I(n);return{x:o.centerX,y:o.centerY}}function k(t,e){var r,u;const n=t.querySelector(".tiles-container");n&&n.remove();const o=document.createElement("div");o.className="tiles-container",t.appendChild(o);const i=((r=e.map)==null?void 0:r.tiles)??{},a=e.systems??{},s=e.entities??[];for(const[f,m]of Object.entries(i)){const l=document.createElement("div");l.className="tile";const M=a[f];M&&(l.classList.add("has-system"),M.generates&&Object.keys(M.generates).length>0&&l.classList.add("generating")),m.blighted&&l.classList.add("blighted"),m.type==="antenna"&&(l.classList.add("antenna"),(((u=e.resources)==null?void 0:u.influence)??0)>.5&&l.classList.add("broadcasting"));const L=I(m);l.style.left=`${L.x}px`,l.style.top=`${L.y}px`;const S=s.filter(y=>y.tile===f&&y.type!=="visitor").length,w=s.filter(y=>y.tile===f&&y.type==="visitor").length;let E="";S>0&&(E+=`<div class="ant-count">${S} ant${S>1?"s":""}</div>`),w>0&&(E+=`<div class="ant-count visitor-count">${w} visitor${w>1?"s":""}</div>`),l.innerHTML=`
      <div class="tile-name">${m.name}</div>
      <div class="tile-info">${m.type}</div>
      ${E}
    `,o.appendChild(l)}}function F(t,e){var i,a;const n=(i=e.map)==null?void 0:i.tiles,o=(a=e.map)==null?void 0:a.connections;if(!(!n||!o)){t.strokeStyle="#333",t.lineWidth=1,t.setLineDash([4,4]);for(const[s,r]of o){const u=c(s,n),f=c(r,n);u&&f&&(t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(f.x,f.y),t.stroke())}t.setLineDash([])}}const h=new Map;function X(t){var i;const e=(i=t.map)==null?void 0:i.tiles,n=t.entities;if(!e||!n)return;for(const a of n){const s=c(a.tile,e);if(!s)continue;let r=h.get(a.id);r||(r={x:s.x+(Math.random()-.5)*60,y:s.y+(Math.random()-.5)*60,targetX:s.x+(Math.random()-.5)*60,targetY:s.y+(Math.random()-.5)*60,type:a.type,subtype:a.subtype,adorned:a.adorned},h.set(a.id,r)),r.x+=(r.targetX-r.x)*.02,r.y+=(r.targetY-r.y)*.02,Math.random()<.01&&(r.targetX=s.x+(Math.random()-.5)*60,r.targetY=s.y+(Math.random()-.5)*60),r.type=a.type,r.subtype=a.subtype,r.adorned=a.adorned}const o=new Set(n.map(a=>a.id));for(const a of h.keys())o.has(a)||h.delete(a)}function Y(t){for(const[e,n]of h){t.beginPath();const o=n.adorned?5:4;if(n.type==="visitor"){const i=n.subtype==="hungry"?"#f88":"#8af";t.arc(n.x,n.y,o,0,Math.PI*2),t.fillStyle=i,t.shadowColor=i,t.shadowBlur=8}else n.adorned?(t.arc(n.x,n.y,o,0,Math.PI*2),t.fillStyle="#ca8",t.shadowColor="#ca8",t.shadowBlur=6):(t.arc(n.x,n.y,o-1,0,Math.PI*2),t.fillStyle="#a85",t.shadowBlur=0);t.fill(),t.shadowBlur=0}}const g=[];function d(t,e,n){g.push({x:t.x,y:t.y,targetX:e.x,targetY:e.y,progress:0,speed:.01+Math.random()*.01,color:n,size:2+Math.random()*2})}function D(){for(let t=g.length-1;t>=0;t--){const e=g[t];e.progress+=e.speed,e.x+=(e.targetX-e.x)*e.speed*2,e.y+=(e.targetY-e.y)*e.speed*2,e.progress>=1&&g.splice(t,1)}}function A(t){var o,i,a;const e=(o=t.map)==null?void 0:o.tiles;if(!e)return;if(Math.random()<.1){const s=c("dig_site",e),r=c("origin",e);s&&r&&d(s,r,"#8b7355")}if(Math.random()<.05){const s=c("compost",e),r=c("origin",e);s&&r&&d(s,r,"#5a8a5a")}if(Math.random()<.05){const s=c("origin",e),r=c("fungus_farm",e);s&&r&&d(s,r,"#5a8a5a")}if(Math.random()<.03){const s=c("fungus_farm",e),r=c("origin",e);s&&r&&d(s,r,"#7a6a9a")}if(Math.random()<.02){const s=c("crystal_cave",e),r=c("resonance_chamber",e);s&&r&&d(s,r,"#aaccff")}if(Math.random()<.08){const s=c("resonance_chamber",e),r=c("origin",e);s&&r&&d(s,r,"#88aacc")}if((((i=t.resources)==null?void 0:i.influence)??0)>0&&Math.random()<.05){const s=c("origin",e),r=c("receiver",e);s&&r&&d(s,r,"#aa88ff")}if(((a=t.entities)==null?void 0:a.some(s=>s.subtype==="observer"))&&Math.random()<.1){const s=c("receiver",e);s&&d({x:s.x+(Math.random()-.5)*30,y:s.y+(Math.random()-.5)*30},{x:s.x,y:s.y-40},"#88ffaa")}}function N(t){for(const e of g)t.beginPath(),t.arc(e.x,e.y,e.size*(1-e.progress*.5),0,Math.PI*2),t.fillStyle=e.color,t.globalAlpha=1-e.progress,t.fill();t.globalAlpha=1}function z(t){const e=document.getElementById("tick");e&&(e.textContent=`tick: ${t.tick}`)}function R(t){const e=document.getElementById("resources");if(!e)return;const n=t.resources??{};if(Object.keys(n).length===0){e.innerHTML='<div class="empty">nothing yet</div>';return}e.innerHTML=Object.entries(n).map(([o,i])=>`
      <div class="resource">
        <span class="resource-name">${o}</span>
        <span class="resource-value">${Math.floor(i??0)}</span>
      </div>
    `).join("")}function q(t){const e=document.getElementById("entities");if(!e)return;const n=t.entities??[];if(n.length===0){e.innerHTML='<div class="empty">no entities</div>';return}const o={},i=[];for(const s of n)if(s.type==="visitor")i.push(s);else{const r=s.role??s.type??"unknown";o[r]=(o[r]??0)+1}let a=Object.entries(o).map(([s,r])=>`
      <div class="stat-row">
        <span class="stat-label">${s}</span>
        <span class="stat-value">${r}</span>
      </div>
    `).join("");for(const s of i)a+=`
      <div class="stat-row visitor-row">
        <span class="stat-label">${s.name??s.subtype??"visitor"}</span>
        <span class="stat-value visitor-subtype">${s.subtype??""}</span>
      </div>
    `;e.innerHTML=a}function G(t){var i;const e=document.getElementById("boredom-fill");if(!e)return;const n=((i=t.meta)==null?void 0:i.boredom)??0,o=Math.min(100,n/60*100);e.style.width=`${o}%`}function W(t){var i;const e=document.getElementById("sanity-fill"),n=document.getElementById("sanity-value");if(!e||!n)return;const o=((i=t.meta)==null?void 0:i.sanity)??100;e.style.width=`${o}%`,n.textContent=`${o.toFixed(1)}%`,o<30?e.style.background="#a44":o<60?e.style.background="#a84":e.style.background="#484"}function J(t){var a,s;const e=document.getElementById("contamination-fill"),n=document.getElementById("contamination-status");if(!e||!n)return;const o=(s=(a=t.map)==null?void 0:a.tiles)==null?void 0:s.compost,i=(o==null?void 0:o.contamination)??0;e.style.width=`${i*100}%`,o!=null&&o.blighted?(n.textContent=`BLIGHTED (${o.blight_ticks_remaining}t remaining)`,n.style.color="#a55"):i>0?(n.textContent=`${(i*100).toFixed(1)}% blight chance`,n.style.color="#755"):(n.textContent="clean",n.style.color="#555")}function K(t){const e=document.getElementById("systems");if(!e)return;const n=t.systems??{};if(Object.keys(n).length===0){e.innerHTML='<div class="empty">no systems</div>';return}e.innerHTML=Object.entries(n).map(([o,i])=>{let a="";return i.generates&&Object.keys(i.generates).length>0&&(a=Object.entries(i.generates).map(([s,r])=>`+${r}/tick ${s}`).join(", ")),`
        <div class="system">
          <div class="system-name">${i.name??o}</div>
          <div class="system-output">${a||"idle"}</div>
        </div>
      `}).join("")}function Z(t){const e=document.getElementById("corpses");if(!e)return;const n=t.graveyard??{corpses:[],total_processed:0},o=n.corpses??[],i=n.total_processed??0;if(o.length===0&&i===0){e.innerHTML='<div class="empty">none</div>';return}e.innerHTML=`
    <div class="stat-row">
      <span class="stat-label">awaiting</span>
      <span class="stat-value">${o.length}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">processed</span>
      <span class="stat-value">${i}</span>
    </div>
  `}function Q(t){var o;const e=document.getElementById("rejected");if(!e)return;const n=((o=t.meta)==null?void 0:o.rejected_ideas)??[];if(n.length===0){e.innerHTML='<div class="empty">empty</div>';return}e.innerHTML=n.map(i=>`<div class="graveyard-item">${i}</div>`).join("")}function U(t){z(t),R(t),q(t),G(t),W(t),J(t),K(t),Z(t),Q(t)}let p=null;function C(){const t=document.getElementById("map");if(!t){console.error("Map container not found");return}const e=t,n=P(e),o=new j("/events");function i(s){p=s,U(s),k(e,s)}function a(){p&&(_(n),F(n.ctx,p),X(p),Y(n.ctx),A(p),D(),N(n.ctx)),requestAnimationFrame(a)}o.onState(i),o.connect(),a(),B().then(s=>{s&&i(s)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C();
//# sourceMappingURL=index-BGtwtWep.js.map

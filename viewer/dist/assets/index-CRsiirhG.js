var X=Object.defineProperty;var N=(e,s,t)=>s in e?X(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var T=(e,s,t)=>N(e,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();class G{constructor(s="/events"){T(this,"eventSource",null);T(this,"handlers",new Set);T(this,"lastState",null);this.url=s}connect(){this.eventSource=new EventSource(this.url),this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.lastState=t,this.handlers.forEach(n=>n(t))}catch(t){console.error("Failed to parse state:",t)}},this.eventSource.onerror=()=>{console.error("SSE connection error, reconnecting..."),this.reconnect()}}reconnect(){this.disconnect(),setTimeout(()=>this.connect(),2e3)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}onState(s){return this.handlers.add(s),this.lastState&&s(this.lastState),()=>this.handlers.delete(s)}getLastState(){return this.lastState}}async function z(){try{return await(await fetch("/state")).json()}catch{return null}}function W(e){const s=document.createElement("canvas");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.pointerEvents="none",e.appendChild(s);const t=s.getContext("2d");function n(){s.width=e.clientWidth,s.height=e.clientHeight}return n(),window.addEventListener("resize",n),{canvas:s,ctx:t,get width(){return s.width},get height(){return s.height}}}function U(e){e.ctx.clearRect(0,0,e.width,e.height)}const V={dirt:"#8b7355",nutrients:"#5a8a5a",fungus:"#7a6a9a",crystals:"#aaccff",ore:"#c9a959",influence:"#aa88ff",insight:"#88ffaa",strange_matter:"#ff88aa"};function q(e){return V[e]??"#888888"}const _=[],P=new Set;function F(){return P}function L(e,s,t,n=!1){_.push({x:e.x,y:e.y,targetX:s.x,targetY:s.y,progress:0,speed:.01+Math.random()*.01,color:q(t),size:2+Math.random()*2,resource:t,stalled:n})}function K(){for(let e=_.length-1;e>=0;e--){const s=_[e];s.progress+=s.speed,s.x+=(s.targetX-s.x)*s.speed*2,s.y+=(s.targetY-s.y)*s.speed*2,s.progress>=1&&_.splice(e,1)}}function J(e,s){if(s[e])return e;const t=`${e}_tile`;if(s[t])return t;for(const n of Object.keys(s))if(n.includes(e)||e.includes(n))return n;return null}function I(e,s,t,n=!0){const o=[];for(const[i,l]of s)i===e&&o.push(l),l===e&&o.push(i);return n&&o.includes("origin")?"origin":o[0]??null}function Z(e){var l,a,c;const s=(l=e.map)==null?void 0:l.tiles,t=e.systems,n=(a=e.map)==null?void 0:a.connections,o=e.resources??{};if(!s||!t||!n)return;P.clear();for(const[d,v]of Object.entries(t)){const m=J(d,s);if(!m)continue;const u=S(m,s);if(u){if(v.generates)for(const[p,r]of Object.entries(v.generates)){if(r<=0)continue;const f=Math.min(.5,r*5);if(Math.random()<f){const g=I(m,n,s,!0);if(g){const h=S(g,s);h&&L(u,h,p)}else L(u,{x:u.x,y:u.y-40},p)}}if(v.consumes)for(const[p,r]of Object.entries(v.consumes)){if(r<=0)continue;const g=(o[p]??0)<r*10;g&&P.add(`${d}:${p}`);const h=Math.min(.3,r*3);if(Math.random()<h){const $=I(m,n,s,!0);if($){const w=S($,s);w&&L(w,u,p,g)}}}}}if(((c=e.entities)==null?void 0:c.some(d=>d.subtype==="observer"))&&Math.random()<.1){const d=S("receiver",s);d&&L({x:d.x+(Math.random()-.5)*30,y:d.y+(Math.random()-.5)*30},{x:d.x,y:d.y-40},"insight")}if((o.influence??0)>.5&&Math.random()<.05){const d=S("origin",s),v=S("receiver",s);d&&v&&L(d,v,"influence")}}function Q(e){for(const s of _){e.beginPath();const t=s.size*(1-s.progress*.5);if(e.arc(s.x,s.y,t,0,Math.PI*2),e.fillStyle=s.color,e.globalAlpha=1-s.progress,s.stalled){const n=.5+Math.sin(Date.now()/200)*.3;e.globalAlpha*=n,e.shadowColor="#ff4444",e.shadowBlur=8}e.fill(),e.shadowBlur=0}e.globalAlpha=1}const O=100,H=20,ee=250,se=150;let j=null;function te(e){j=e}function D(e){const s=e.x*(O+H)+ee,t=e.y*(O+H)+se;return{x:s,y:t,centerX:s+O/2,centerY:t+O/2}}function S(e,s){const t=s[e];if(!t)return null;const n=D(t);return{x:n.centerX,y:n.centerY}}function ne(e,s){var d,v;const t=e.querySelector(".tiles-container");t&&t.remove();const n=document.createElement("div");n.className="tiles-container",e.appendChild(n);const o=((d=s.map)==null?void 0:d.tiles)??{},i=s.systems??{},l=s.entities??[],a=F(),c=new Set;for(const m of a){const u=m.split(":")[0];if(o[u])c.add(u);else{const p=`${u}_tile`;o[p]&&c.add(p)}}for(const[m,u]of Object.entries(o)){const p=document.createElement("div");p.className="tile",p.dataset.tileId=m;const r=i[m];r&&(p.classList.add("has-system"),r.generates&&Object.keys(r.generates).length>0&&p.classList.add("generating")),c.has(m)&&p.classList.add("has-bottleneck"),u.blighted&&p.classList.add("blighted"),u.type==="antenna"&&(p.classList.add("antenna"),(((v=s.resources)==null?void 0:v.influence)??0)>.5&&p.classList.add("broadcasting"));const f=D(u);p.style.left=`${f.x}px`,p.style.top=`${f.y}px`;const g=l.filter(w=>w.tile===m&&w.type!=="visitor").length,h=l.filter(w=>w.tile===m&&w.type==="visitor").length;let $="";g>0&&($+=`<div class="ant-count">${g} ant${g>1?"s":""}</div>`),h>0&&($+=`<div class="ant-count visitor-count">${h} visitor${h>1?"s":""}</div>`),p.innerHTML=`
      <div class="tile-name">${u.name}</div>
      <div class="tile-info">${u.type}</div>
      ${$}
    `,p.addEventListener("click",()=>{j&&j(m,u)}),n.appendChild(p)}}function oe(e,s){var o,i;const t=(o=s.map)==null?void 0:o.tiles,n=(i=s.map)==null?void 0:i.connections;if(!(!t||!n)){e.strokeStyle="#333",e.lineWidth=1,e.setLineDash([4,4]);for(const[l,a]of n){const c=S(l,t),d=S(a,t);c&&d&&(e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(d.x,d.y),e.stroke())}e.setLineDash([])}}const k=new Map;function x(){return k}function ae(e){var o;const s=(o=e.map)==null?void 0:o.tiles,t=e.entities;if(!s||!t)return;for(const i of t){const l=S(i.tile,s);if(!l)continue;let a=k.get(i.id);a||(a={x:l.x+(Math.random()-.5)*60,y:l.y+(Math.random()-.5)*60,targetX:l.x+(Math.random()-.5)*60,targetY:l.y+(Math.random()-.5)*60,type:i.type,subtype:i.subtype,adorned:i.adorned,entity:i},k.set(i.id,a)),a.x+=(a.targetX-a.x)*.02,a.y+=(a.targetY-a.y)*.02,Math.random()<.01&&(a.targetX=l.x+(Math.random()-.5)*60,a.targetY=l.y+(Math.random()-.5)*60),a.type=i.type,a.subtype=i.subtype,a.adorned=i.adorned,a.entity=i}const n=new Set(t.map(i=>i.id));for(const i of k.keys())n.has(i)||k.delete(i)}function ie(e){for(const[s,t]of k){e.beginPath();const n=t.adorned?5:4;if(t.type==="visitor"){const o=t.subtype==="hungry"?"#f88":"#8af";e.arc(t.x,t.y,n,0,Math.PI*2),e.fillStyle=o,e.shadowColor=o,e.shadowBlur=8}else t.adorned?(e.arc(t.x,t.y,n,0,Math.PI*2),e.fillStyle="#ca8",e.shadowColor="#ca8",e.shadowBlur=6):(e.arc(t.x,t.y,n-1,0,Math.PI*2),e.fillStyle="#a85",e.shadowBlur=0);e.fill(),e.shadowBlur=0}}const C=new Map;function le(e){var o,i;const s=(o=e.map)==null?void 0:o.tiles,t=((i=e.graveyard)==null?void 0:i.corpses)??[];if(!s)return;const n=new Set(t.map(l=>l.entity_id));for(const l of t)if(!C.has(l.entity_id)){const a=S(l.tile,s);a&&C.set(l.entity_id,{id:l.entity_id,x:a.x+(Math.random()-.5)*40,y:a.y+(Math.random()-.5)*40,baseY:a.y+(Math.random()-.5)*40,alpha:.6,phase:Math.random()*Math.PI*2,isVisitor:l.entity_type==="visitor"})}for(const[l,a]of C)a.phase+=.02,a.y=a.baseY+Math.sin(a.phase)*5-a.phase*.3,a.alpha-=5e-4,(a.alpha<=0||a.y<a.baseY-50)&&C.delete(l);for(const l of C.keys())if(!n.has(l)){const a=C.get(l);a&&(a.alpha-=.02,a.alpha<=0&&C.delete(l))}}function ce(e){for(const[s,t]of C){e.save(),e.globalAlpha=t.alpha;const n=e.createRadialGradient(t.x,t.y,0,t.x,t.y,12);t.isVisitor?(n.addColorStop(0,"rgba(150, 180, 255, 0.8)"),n.addColorStop(.5,"rgba(100, 130, 200, 0.4)"),n.addColorStop(1,"rgba(80, 100, 180, 0)")):(n.addColorStop(0,"rgba(220, 200, 180, 0.8)"),n.addColorStop(.5,"rgba(180, 160, 140, 0.4)"),n.addColorStop(1,"rgba(150, 130, 110, 0)")),e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,12,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t.x-2,t.y-2,3,0,Math.PI*2),e.fillStyle=t.isVisitor?"rgba(200, 220, 255, 0.5)":"rgba(255, 250, 240, 0.5)",e.fill(),e.restore()}}function re(e){const s=document.getElementById("tick");s&&(s.textContent=`tick: ${e.tick}`)}function de(e){const s=document.getElementById("resources");if(!s)return;const t=e.resources??{};if(Object.keys(t).length===0){s.innerHTML='<div class="empty">nothing yet</div>';return}s.innerHTML=Object.entries(t).map(([n,o])=>`
      <div class="resource">
        <span class="resource-name">${n}</span>
        <span class="resource-value">${Math.floor(o??0)}</span>
      </div>
    `).join("")}function pe(e){const s=document.getElementById("entities");if(!s)return;const t=e.entities??[];if(t.length===0){s.innerHTML='<div class="empty">no entities</div>';return}const n={},o=[];for(const l of t)if(l.type==="visitor")o.push(l);else{const a=l.role??l.type??"unknown";n[a]=(n[a]??0)+1}let i=Object.entries(n).map(([l,a])=>`
      <div class="stat-row">
        <span class="stat-label">${l}</span>
        <span class="stat-value">${a}</span>
      </div>
    `).join("");for(const l of o)i+=`
      <div class="stat-row visitor-row">
        <span class="stat-label">${l.name??l.subtype??"visitor"}</span>
        <span class="stat-value visitor-subtype">${l.subtype??""}</span>
      </div>
    `;s.innerHTML=i}function ue(e){var o;const s=document.getElementById("boredom-fill");if(!s)return;const t=((o=e.meta)==null?void 0:o.boredom)??0,n=Math.min(100,t/60*100);s.style.width=`${n}%`}function fe(e){var o;const s=document.getElementById("sanity-fill"),t=document.getElementById("sanity-value");if(!s||!t)return;const n=((o=e.meta)==null?void 0:o.sanity)??100;s.style.width=`${n}%`,t.textContent=`${n.toFixed(1)}%`,n<30?s.style.background="#a44":n<60?s.style.background="#a84":s.style.background="#484"}function me(e){var i,l;const s=document.getElementById("contamination-fill"),t=document.getElementById("contamination-status");if(!s||!t)return;const n=(l=(i=e.map)==null?void 0:i.tiles)==null?void 0:l.compost,o=(n==null?void 0:n.contamination)??0;s.style.width=`${o*100}%`,n!=null&&n.blighted?(t.textContent=`BLIGHTED (${n.blight_ticks_remaining}t remaining)`,t.style.color="#a55"):o>0?(t.textContent=`${(o*100).toFixed(1)}% blight chance`,t.style.color="#755"):(t.textContent="clean",t.style.color="#555")}function ve(e){const s=document.getElementById("systems");if(!s)return;const t=e.systems??{};if(Object.keys(t).length===0){s.innerHTML='<div class="empty">no systems</div>';return}s.innerHTML=Object.entries(t).map(([n,o])=>{let i="";return o.generates&&Object.keys(o.generates).length>0&&(i=Object.entries(o.generates).map(([l,a])=>`+${a}/tick ${l}`).join(", ")),`
        <div class="system">
          <div class="system-name">${o.name??n}</div>
          <div class="system-output">${i||"idle"}</div>
        </div>
      `}).join("")}function ge(e){const s=document.getElementById("corpses");if(!s)return;const t=e.graveyard??{corpses:[],total_processed:0},n=t.corpses??[],o=t.total_processed??0;if(n.length===0&&o===0){s.innerHTML='<div class="empty">none</div>';return}s.innerHTML=`
    <div class="stat-row">
      <span class="stat-label">awaiting</span>
      <span class="stat-value">${n.length}</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">processed</span>
      <span class="stat-value">${o}</span>
    </div>
  `}function he(e){var n;const s=document.getElementById("rejected");if(!s)return;const t=((n=e.meta)==null?void 0:n.rejected_ideas)??[];if(t.length===0){s.innerHTML='<div class="empty">empty</div>';return}s.innerHTML=t.map(o=>`<div class="graveyard-item">${o}</div>`).join("")}function ye(e){var o;const s=document.getElementById("event-log");if(!s)return;const t=((o=e.meta)==null?void 0:o.event_log)??[];if(t.length===0){s.innerHTML='<div class="empty">no events yet</div>';return}const n=t.slice(-10).reverse();s.innerHTML=n.map(i=>`
      <div class="event-entry event-type-${i.type}">
        <div class="event-tick">t${i.tick}</div>
        <div class="event-message">${i.message}</div>
      </div>
    `).join("")}function be(e){var i;const s=document.getElementById("goals");if(!s)return;const t=((i=e.meta)==null?void 0:i.goals)??{},n=e.resources??{},o=Object.entries(t).filter(([l,a])=>!a.built&&a.progress!==void 0);if(o.length===0){s.innerHTML='<div class="empty">no active goals</div>';return}s.innerHTML=o.map(([l,a])=>{const c=Object.entries(a.cost),d=c.map(([m,u])=>{var h;const p=n[m]??0,r=((h=a.progress)==null?void 0:h[m])??0,f=Math.min(100,r/u*100),g=p>0&&r<u;return`
          <div class="goal-resource">
            <div class="goal-resource-header">
              <span class="goal-resource-name">${m}</span>
              <span class="goal-resource-count">${Math.floor(r)}/${u}</span>
            </div>
            <div class="goal-bar">
              <div class="goal-bar-fill ${g?"can-contribute":""}" style="width: ${f}%"></div>
            </div>
          </div>
        `}).join(""),v=c.reduce((m,[u,p])=>{var f;const r=((f=a.progress)==null?void 0:f[u])??0;return m+r/p},0)/c.length*100;return`
        <div class="goal-card">
          <div class="goal-header">
            <span class="goal-name">${a.name}</span>
            <span class="goal-pct">${v.toFixed(0)}%</span>
          </div>
          <div class="goal-desc">${a.description}</div>
          <div class="goal-resources">
            ${d}
          </div>
        </div>
      `}).join("")}function $e(e){const s=document.getElementById("decisions");if(!s)return;if(e.length===0){s.innerHTML='<div class="empty">no decisions logged</div>';return}const t=[...e].reverse();s.innerHTML=t.map(n=>`
      <div class="decision-entry">
        <div class="decision-tick">t${n.tick}<span class="decision-type">${n.type}</span></div>
        <div class="decision-choice">${n.choice}</div>
        ${n.why?`<div class="decision-why">${n.why}</div>`:""}
      </div>
    `).join("")}function we(e){re(e),de(e),pe(e),ue(e),fe(e),me(e),ve(e),ge(e),he(e),ye(e),be(e)}let y=null;function Me(){y=document.createElement("div"),y.className="entity-tooltip",y.style.display="none",document.body.appendChild(y)}function Y(e,s,t,n=20){let o=null,i=n;for(const[l,a]of t){const c=a.x-e,d=a.y-s,v=Math.sqrt(c*c+d*d);v<i&&(i=v,o=a.entity)}return o}function Se(e,s,t){if(!y)return;const n=s.getBoundingClientRect(),o=e.clientX-n.left,i=e.clientY-n.top,l=Y(o,i,t);l?Ce(l,e.clientX,e.clientY):ke()}function Ee(e,s,t){const n=s.getBoundingClientRect(),o=e.clientX-n.left,i=e.clientY-n.top;return Y(o,i,t)}function Ce(e,s,t){if(!y)return;const n=(e.age/e.max_age*100).toFixed(1),o=e.hunger.toFixed(1);let i='<div class="tooltip-header">';e.type==="visitor"?i+=`<span class="tooltip-type visitor">${e.name||e.subtype||"visitor"}</span>`:(i+=`<span class="tooltip-type">${e.role||"ant"}</span>`,e.adorned&&(i+='<span class="tooltip-adorned">‚òÖ</span>')),i+="</div>",i+='<div class="tooltip-stats">',i+=`<div class="tooltip-row"><span>age:</span><span>${n}%</span></div>`,i+=`<div class="tooltip-row"><span>hunger:</span><span>${o}</span></div>`,i+=`<div class="tooltip-row"><span>tile:</span><span>${e.tile}</span></div>`,e.type==="visitor"&&e.description&&(i+=`<div class="tooltip-desc">${e.description}</div>`),e.processing_corpse&&(i+='<div class="tooltip-activity">processing corpse...</div>'),i+="</div>",y.innerHTML=i,y.style.display="block",y.style.left=`${s+15}px`,y.style.top=`${t+15}px`}function ke(){y&&(y.style.display="none")}let b=null,E=null;function Le(){E=document.createElement("div"),E.className="modal-backdrop",E.style.display="none",E.addEventListener("click",A),document.body.appendChild(E),b=document.createElement("div"),b.className="modal",b.style.display="none",b.addEventListener("click",e=>e.stopPropagation()),document.body.appendChild(b)}function A(){b&&(b.style.display="none"),E&&(E.style.display="none")}function R(e,s){if(!b||!E)return;b.innerHTML=`
    <div class="modal-header">
      <span class="modal-title">${s}</span>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      ${e}
    </div>
  `;const t=b.querySelector(".modal-close");t==null||t.addEventListener("click",A),E.style.display="block",b.style.display="block"}function _e(e,s,t){var d,v,m,u,p;const n=(d=t.systems)==null?void 0:d[e],o=((v=t.entities)==null?void 0:v.filter(r=>r.tile===e))??[],i=((m=t.map)==null?void 0:m.connections)??[],l=F(),a=[];for(const[r,f]of i)r===e&&a.push(f),f===e&&a.push(r);let c='<div class="modal-section">';if(c+=`<div class="modal-row"><span class="modal-label">Type:</span><span>${s.type}</span></div>`,s.description&&(c+=`<div class="modal-desc">${s.description}</div>`),s.resource&&(c+=`<div class="modal-row"><span class="modal-label">Resource:</span><span>${s.resource}</span></div>`),c+="</div>",(s.contamination!==void 0||s.blighted)&&(c+='<div class="modal-section">',c+="<h3>Status</h3>",s.blighted?c+=`<div class="modal-warning">BLIGHTED - ${s.blight_ticks_remaining} ticks remaining</div>`:s.contamination&&s.contamination>0?c+=`<div class="modal-row"><span class="modal-label">Contamination:</span><span>${(s.contamination*100).toFixed(1)}%</span></div>`:c+='<div class="modal-row"><span class="modal-label">Contamination:</span><span>clean</span></div>',c+="</div>"),n){if(c+='<div class="modal-section">',c+=`<h3>System: ${n.name}</h3>`,n.description&&(c+=`<div class="modal-desc">${n.description}</div>`),n.generates&&Object.keys(n.generates).length>0){c+='<div class="modal-subsection"><strong>Produces:</strong></div>';for(const[r,f]of Object.entries(n.generates))c+=`<div class="modal-row"><span class="modal-label">${r}</span><span class="modal-value-good">+${f}/tick</span></div>`}if(n.consumes&&Object.keys(n.consumes).length>0){c+='<div class="modal-subsection"><strong>Consumes:</strong></div>';for(const[r,f]of Object.entries(n.consumes)){const g=l.has(`${e}:${r}`);c+=`<div class="modal-row"><span class="modal-label">${r}</span><span class="modal-value-bad ${g?"modal-value-warning":""}">-${f}/tick${g?" (LOW)":""}</span></div>`}}if(n.sanity_efficiency!==void 0){const r=(n.sanity_efficiency*100).toFixed(1);c+=`<div class="modal-row"><span class="modal-label">Sanity efficiency:</span><span>${r}%</span></div>`}c+="</div>"}if(a.length>0){c+='<div class="modal-section">',c+="<h3>Connections</h3>",c+='<div class="modal-tags">';for(const r of a){const f=(p=(u=t.map)==null?void 0:u.tiles)==null?void 0:p[r];c+=`<span class="modal-tag">${(f==null?void 0:f.name)??r}</span>`}c+="</div></div>"}if(o.length>0){c+='<div class="modal-section">',c+=`<h3>Entities Here (${o.length})</h3>`;for(const r of o){const f=(r.age/r.max_age*100).toFixed(0),g=r.type==="visitor"?"üëÅ":r.adorned?"‚òÖ":"‚Ä¢",h=r.type==="visitor"?r.name??r.subtype??"visitor":r.role??"ant";c+='<div class="modal-entity">',c+=`<span class="modal-entity-icon">${g}</span>`,c+=`<span class="modal-entity-name">${h}</span>`,c+=`<span class="modal-entity-stat">age ${f}%</span>`,c+=`<span class="modal-entity-stat">hunger ${r.hunger.toFixed(0)}</span>`,c+="</div>"}c+="</div>"}R(c,s.name)}function Te(e,s){var r,f,g,h;const t=(f=(r=s.map)==null?void 0:r.tiles)==null?void 0:f[e.tile],n=(h=(g=s.meta)==null?void 0:g.jewelry)==null?void 0:h.find($=>$.worn_by===e.id);let o='<div class="modal-section">';const i=e.type==="visitor"?e.subtype??"visitor":e.role??"ant";o+=`<div class="modal-row"><span class="modal-label">Type:</span><span>${i}</span></div>`,o+=`<div class="modal-row"><span class="modal-label">ID:</span><span class="modal-id">${e.id}</span></div>`,o+=`<div class="modal-row"><span class="modal-label">Location:</span><span>${(t==null?void 0:t.name)??e.tile}</span></div>`,e.description&&(o+=`<div class="modal-desc">${e.description}</div>`),o+="</div>",o+='<div class="modal-section">',o+="<h3>Vitals</h3>";const l=e.age/e.max_age*100,a=l>80?"modal-value-warning":"";o+=`<div class="modal-row"><span class="modal-label">Age:</span><span class="${a}">${e.age} / ${e.max_age} ticks (${l.toFixed(1)}%)</span></div>`;const c=e.hunger<30?"modal-value-warning":"";o+=`<div class="modal-row"><span class="modal-label">Hunger:</span><span class="${c}">${e.hunger.toFixed(1)}</span></div>`,o+=`<div class="modal-row"><span class="modal-label">Hunger rate:</span><span>-${e.hunger_rate}/tick</span></div>`,o+=`<div class="modal-row"><span class="modal-label">Food:</span><span>${e.food}</span></div>`;const d=e.hunger/e.hunger_rate,v=e.max_age-e.age,m=Math.min(d,v),u=d<v?"starvation":"old age";if(o+=`<div class="modal-row"><span class="modal-label">Est. lifespan:</span><span>~${Math.floor(m)} ticks (${u})</span></div>`,o+="</div>",e.adorned||n||e.processing_corpse||e.generates){if(o+='<div class="modal-section">',o+="<h3>Special</h3>",e.adorned&&n&&(o+=`<div class="modal-row"><span class="modal-label">Wearing:</span><span class="modal-value-special">${n.name}</span></div>`,o+=`<div class="modal-row"><span class="modal-label">Adorned at:</span><span>tick ${n.worn_tick}</span></div>`),e.processing_corpse&&(o+=`<div class="modal-row"><span class="modal-label">Activity:</span><span>Processing corpse (${e.processing_ticks} ticks)</span></div>`),e.previous_role&&(o+=`<div class="modal-row"><span class="modal-label">Previous role:</span><span>${e.previous_role}</span></div>`),e.generates){o+='<div class="modal-subsection"><strong>Generates:</strong></div>';for(const[$,w]of Object.entries(e.generates))o+=`<div class="modal-row"><span class="modal-label">${$}</span><span class="modal-value-good">+${w}/tick</span></div>`}e.influence_rate&&(o+=`<div class="modal-row"><span class="modal-label">Influence rate:</span><span>${e.influence_rate}/tick</span></div>`),o+="</div>"}e.type==="visitor"&&e.from_outside&&(o+='<div class="modal-section">',o+='<div class="modal-note">This entity came from the Outside.</div>',o+="</div>");const p=e.name??(e.adorned?`‚òÖ ${i}`:i);R(o,p)}let M=null;function B(){const e=document.getElementById("map");if(!e){console.error("Map container not found");return}const s=e,t=W(s),n=new G("/events");Me(),Le(),te((a,c)=>{M&&_e(a,c,M)}),s.addEventListener("mousemove",a=>{const c=x();Se(a,s,c)}),s.addEventListener("click",a=>{const c=x(),d=Ee(a,s,c);d&&M&&Te(d,M)});function o(a){M=a,we(a),ne(s,a)}function i(){M&&(U(t),oe(t.ctx,M),le(M),ce(t.ctx),ae(M),ie(t.ctx),Z(M),K(),Q(t.ctx)),requestAnimationFrame(i)}n.onState(o),n.connect(),i(),z().then(a=>{a&&o(a)});async function l(){try{const a=await fetch("/decisions");if(a.ok){const c=await a.json();$e(c)}}catch(a){console.error("Failed to fetch decisions:",a)}}l(),setInterval(l,1e4)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();
//# sourceMappingURL=index-CRsiirhG.js.map
